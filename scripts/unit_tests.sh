#!/bin/bash

set -o pipefail

echo "­ЪћЇ рЃЋрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉ рЃЊрЃљрЃЏрЃЮрЃЎрЃўрЃЊрЃћрЃЉрЃБрЃџрЃћрЃЉрЃћрЃЉрЃА..."
pip install -r requirements.txt
if [ $? -ne 0 ]; then
    echo "РЮї рЃЉрЃўрЃЉрЃџрЃўрЃЮрЃЌрЃћрЃЎрЃћрЃЉрЃўрЃА рЃЊрЃљрЃДрЃћрЃюрЃћрЃЉрЃљ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ!"
    exit 1
fi

echo "­Ъџђ рЃбрЃћрЃАрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљ..."
# рЃЋрЃўрЃДрЃћрЃюрЃћрЃЉрЃЌ tee-рЃА рЃџрЃЮрЃњрЃўрЃарЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА. pipefail-рЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ рЃљрЃЦ $? рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА 0 рЃўрЃЦрЃюрЃћрЃЉрЃЮрЃЊрЃљ
pytest tests/ | tee test_results.log

# рЃЋрЃўрЃюрЃљрЃ«рЃљрЃЋрЃЌ рЃАрЃбрЃљрЃбрЃБрЃАрЃА
EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "РюЁ рЃбрЃћрЃАрЃбрЃћрЃЉрЃў рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџрЃўрЃљ!"
else
    echo "РЮї рЃбрЃћрЃАрЃбрЃћрЃЉрЃў рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ рЃЎрЃЮрЃЊрЃўрЃЌ: $EXIT_CODE"
fi

# рЃЋрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃЌ рЃАрЃбрЃљрЃбрЃБрЃАрЃА GitHub Actions-рЃўрЃАрЃЌрЃЋрЃўрЃА
exit $EXIT_CODE
